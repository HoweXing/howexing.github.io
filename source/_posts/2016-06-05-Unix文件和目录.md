---
title: Unix文件和目录
date: 2016-06-05 00:00:33
tags:
  - unix
  - c
---
文件属性含义，修改文件属性，Unix文件系统结构和符号链接，目录操作。

## 函数stat、fstat、fstatat和lstat

```cpp
#include <sys/stat.h>
int stat(const char *restrict pathname, struct stat *restrict buf);
int fstat(int fd, struct stat *buf);
int lstat(const char *restrict pathname, struct stat *restrict buf);
int fstatat(int fd, const char restrict pathname, struct stat *restrict buf, int flag);
```

stat函数返回指定路径文件有关的信息结构。

fstat函数获得已在fd上打开文件的信息。

lstat函数类似与stat，但当文件是一个符号链接时，lstat返回该符号连接的信息，而不是由该符号链接引用的文件的信息。

fstatat是使用相对与fd的相对位置，这种带at的函数在文件系统中很常见，在说文件I/O时也介绍了open和openat在相对路径上的特点，都类似的，可参照。对于符号链接，fstatat函数返回：

* 符号链接所指向的文件的信息（默认）
* 符号链接本身的信息（设置了AT\_SYMLINK\_NOFOLLOW标志）
<!--more-->

buf是一个指向结构的指针，上述函数来填充这个结构。

## 文件类型

Unix文件系统总共有6类文件：

1. 普通文件，Unix内核并不区分文本文件和二进制文件，文件内容的解释是应用程序干的事。

2. 目录文件，包含了其他文件名字以及指向与这些文件有关信息的指针，对一个目录有读权限的任一进程都可以读目录的内容，只有内核可以直接写目录文件，更改目录必须使用目录函数。

3. 块特殊文件，对设备的带缓冲的访问，一次读写固定大小。

4. 字符特殊文件，对设备不带缓冲的访问，每次访问长度可变。系统中的设备要么是字符特殊文件，要么就是块特殊文件。

5. FIFO，命名管道。

6. 套接字。

7. 符号链接，这种文件指向另一个文件。

## 设置用户ID和设置组ID

与一个进程相关联的ID有至少6个。

![进程相关的用户ID和组ID](http://o877ej38d.bkt.clouddn.com/apue-4.5.PNG)
